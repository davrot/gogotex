services:

############
# Keycloak #
############
  keycloak-postgres:
    extends:
      file: ./keycloak-service/keycloak-postgres.yaml
      service: keycloak-postgres

  keycloak-keycloak:
    extends:
      file: ./keycloak-service/keycloak.yaml
      service: keycloak-keycloak
    depends_on:
      keycloak-postgres:
        condition: service_healthy

###########
# MONGODB #
###########
  mongodb-mongodb:
    extends:
      file: ./mongodb-service/mongodb.yaml
      service: mongodb-mongodb

  mongodb-express:
    extends:
      file: ./mongodb-service/mongodb-express.yaml
      service: mongodb-express
    depends_on:
      mongodb-mongodb:
        condition: service_healthy

  mongodb-exporter:
    extends:
      file: ./mongodb-service/mongodb-exporter.yaml
      service: mongodb-exporter
    depends_on:
      mongodb-mongodb:
        condition: service_healthy

  mongodb-exporter-healthcheck:
    extends:
      file: ./mongodb-service/mongodb-exporter-healthcheck.yaml
      service: mongodb-exporter-healthcheck
    depends_on:
      - mongodb-exporter

#########
# REDIS #
#########
  redis-redis:
    extends:
      file: ./redis-service/redis.yaml
      service: redis-redis

  redis-commander:
    extends:
      file: ./redis-service/redis-commander.yaml
      service: redis-commander
    depends_on:
      redis-redis:
        condition: service_healthy

  redis-exporter:
    extends:
      file: ./redis-service/redis-exporter.yaml
      service: redis-exporter
    depends_on:
      redis-redis:
        condition: service_healthy

  redis-exporter-healthcheck:
    extends:
      file: ./redis-service/redis-exporter-healthcheck.yaml
      service: redis-exporter-healthcheck
    depends_on:
      - redis-exporter

#########
# MINIO #
#########
  minio-minio:
    extends:
      file: ./minio-service/minio.yaml
      service: minio-minio

###########
# GRAFANA #
###########
  grafana-prometheus:
    extends:
      file: ./grafana-service/prometheus.yaml
      service: grafana-prometheus
    depends_on:
      redis-exporter-healthcheck:
        condition: service_healthy
      mongodb-exporter-healthcheck:
        condition: service_healthy
      minio-minio:
        condition: service_healthy

  grafana-grafana:
    extends:
      file: ./grafana-service/grafana.yaml
      service: grafana-grafana
    depends_on:
      grafana-prometheus:
        condition: service_healthy

#########
# nginx #
#########
  nginx-nginx:
    extends:
      file: ./nginx-service/nginx.yaml
      service: nginx-nginx
    depends_on:
      grafana-grafana:
        condition: service_healthy
      keycloak-keycloak:
        condition: service_healthy
      mongodb-express:
        condition: service_healthy
      redis-commander:
        condition: service_healthy

networks:
  tex-network:
    external: true

