services:
  mongodb-express:
    image: mongo-express:latest
    container_name: mongodb-express
    hostname: mongodb-express
    restart: unless-stopped

    environment:
      - ME_CONFIG_MONGODB_URL=mongodb://mongodb-mongodb:27017/?replicaSet=gogotex
      - ME_CONFIG_MONGODB_ADMINUSERNAME=""
      - ME_CONFIG_MONGODB_ADMINPASSWORD=""

      - ME_CONFIG_BASICAUTH=true
      - ME_CONFIG_BASICAUTH_USERNAME=admin
      - ME_CONFIG_BASICAUTH_PASSWORD=${MONGOEXPRESS_PASSWORD}
    networks:
      - tex-network

    healthcheck:
      test: ["CMD", "node", "-e", "const http=require('http'); const user=process.env.ME_CONFIG_BASICAUTH_USERNAME||''; const pass=process.env.ME_CONFIG_BASICAUTH_PASSWORD||''; const options={host:'127.0.0.1', port:8081, path:'/', headers:{'Authorization':'Basic '+Buffer.from(user+':'+pass).toString('base64')}}; http.get(options,res=>{process.exit(res.statusCode===200?0:1)}).on('error',()=>process.exit(1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

networks:
  tex-network:
    external: true
